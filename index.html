<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Sorteio ao Vivo</title>

<style>
:root {
  --destaque: #fbba16;
  --cinza: #777;
}

* {
  box-sizing: border-box;
  user-select: none;
}

html, body {
  margin: 0;
  padding: 0;
  height: 100%;
  background: #000;
  color: #fff;
  font-family: Arial, Helvetica, sans-serif;
  overflow: hidden;
}

body {
  display: flex;
  flex-direction: column;
  align-items: center;
}

header {
  text-align: center;
  padding-top: 24px;
}

header img {
  height: 80px;
  margin-bottom: 8px;
}

header h1 {
  margin: 0;
  font-size: 32px;
  font-weight: 600;
}

#container {
  flex: 1;
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
}

#lista {
  height: 60vh;
  width: 100%;
  max-width: 600px;
  overflow: hidden;
  position: relative;
}

.participante {
  height: 56px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 18px;
  color: var(--cinza);
  opacity: 0.4;
  will-change: transform, opacity, color;
}

.participante.medio {
  color: #fff;
  opacity: 0.7;
}

.participante.ativo {
  color: var(--destaque);
  opacity: 1;
}

#linha-centro {
  position: absolute;
  top: 50%;
  left: 0;
  right: 0;
  height: 0;
  pointer-events: none;
}

#btnSortear {
  margin-bottom: 24px;
  padding: 14px 36px;
  font-size: 20px;
  border: none;
  border-radius: 40px;
  background: var(--destaque);
  color: #000;
  cursor: pointer;
  transition: opacity 0.4s ease;
}

#btnSortear.fade {
  opacity: 0;
  pointer-events: none;
}

#overlay {
  position: absolute;
  inset: 0;
  background: #000;
  display: flex;
  justify-content: center;
  align-items: center;
  flex-direction: column;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.8s ease;
}

#overlay.ativo {
  opacity: 1;
  pointer-events: all;
}

#overlay h2 {
  font-size: 64px;
  color: var(--destaque);
  margin: 0;
}

#overlay p {
  margin-top: 16px;
  font-size: 24px;
}

</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Logo">
  <h1>Sorteio ao Vivo</h1>
</header>

<div id="container">

  <div id="lista"></div>
  <div id="linha-centro"></div>

  <div id="overlay">
    <h2 id="ganhador"></h2>
    <p>Parabéns, você é o(a) ganhador(a) do sorteio!</p>
  </div>

</div>

<button id="btnSortear">Iniciar sorteio</button>

<audio id="somScroll" src="click1.mp3"></audio>
<audio id="somSorteio" src="click2.mp3"></audio>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSOjLw7gUCEfb1a9WbWWL2nx7IziAzih82r3tJCUIK_G6_9cVFkVhv6BwoqB3NhmFxLu5HHhDpVC4BG/pub?output=csv";
const COLUNA_NOME = 1;

const lista = document.getElementById("lista");
const btn = document.getElementById("btnSortear");
const overlay = document.getElementById("overlay");
const ganhadorEl = document.getElementById("ganhador");

const somScroll = document.getElementById("somScroll");
const somSorteio = document.getElementById("somSorteio");

let participantes = [];
let alturaItem = 56;
let ultimoIndexAtivo = -1;
let scrollTravado = false;

async function carregarParticipantes() {
  const res = await fetch(CSV_URL);
  const txt = await res.text();
  const linhas = txt.split("\n").slice(1);

  participantes = linhas
    .map(l => l.split(",")[COLUNA_NOME])
    .filter(Boolean)
    .map(n => n.replace(/(^"|"$)/g, "").trim());

  lista.innerHTML = "";
  participantes.forEach(nome => {
    const div = document.createElement("div");
    div.className = "participante";
    div.textContent = nome;
    lista.appendChild(div);
  });
}

function loopFoco() {
  const itens = document.querySelectorAll(".participante");
  const centro = lista.scrollTop + lista.clientHeight / 2;

  let maisProximo = -1;
  let menorDist = Infinity;

  itens.forEach((el, i) => {
    const box = el.offsetTop + alturaItem / 2;
    const dist = Math.abs(box - centro);

    if (dist < menorDist) {
      menorDist = dist;
      maisProximo = i;
    }

    el.classList.remove("ativo", "medio");

    if (dist < alturaItem * 0.5) {
      el.classList.add("ativo");
      el.style.transform = "scale(1.35)";
    } else if (dist < alturaItem * 1.5) {
      el.classList.add("medio");
      el.style.transform = "scale(1.1)";
    } else {
      el.style.transform = "scale(0.9)";
    }
  });

  if (maisProximo !== ultimoIndexAtivo) {
    ultimoIndexAtivo = maisProximo;
    somScroll.currentTime = 0;
    somScroll.volume = 0.35;
    somScroll.play();
  }

  requestAnimationFrame(loopFoco);
}

lista.addEventListener("wheel", e => {
  e.preventDefault();
  if (scrollTravado) return;
  scrollTravado = true;

  const dir = e.deltaY > 0 ? 1 : -1;
  lista.scrollBy({ top: dir * alturaItem, behavior: "smooth" });

  setTimeout(() => scrollTravado = false, 240);
}, { passive: false });

btn.onclick = () => {
  btn.classList.add("fade");
  lista.style.opacity = 0;

  setTimeout(() => {
    lista.style.display = "none";
    overlay.classList.add("ativo");

    let i = 0;
    const intervalo = setInterval(() => {
      ganhadorEl.textContent = participantes[Math.floor(Math.random() * participantes.length)];
      somSorteio.currentTime = 0;
      somSorteio.play();
      i++;
      if (i > 30) {
        clearInterval(intervalo);
        ganhadorEl.style.transform = "scale(1.2)";
      }
    }, 80);

  }, 600);
};

carregarParticipantes().then(() => {
  requestAnimationFrame(loopFoco);
});
</script>

</body>
</html>
