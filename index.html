<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sorteio ao Vivo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --destaque: #fbba16;
  --cinza: #777;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
}

body {
  background: #000;
  color: #fff;
  height: 100vh;
  overflow: hidden;
}

/* TOPO */
header {
  text-align: center;
  padding-top: 32px;
}

header img {
  height: 80px;
  margin-bottom: 16px;
}

header h1 {
  font-size: 40px;
  font-weight: 700;
}

/* ÁREA CENTRAL */
main {
  height: calc(100vh - 200px);
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
}

/* LISTA */
.lista-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow-y: scroll;
  scrollbar-width: none;
}

.lista-container::-webkit-scrollbar {
  display: none;
}

.lista {
  padding-top: 45vh;
  padding-bottom: 45vh;
}

.participante {
  text-align: center;
  padding: 14px 0;
  font-size: 28px;
  color: var(--cinza);
  transform: scale(0.7);
  opacity: 0.35;
  transition:
    transform 0.2s ease-out,
    opacity 0.2s ease-out,
    color 0.2s ease-out;
}

/* ROLETA */
.roleta {
  position: absolute;
  text-align: center;
  opacity: 0;
  transition: opacity 1s ease;
}

.roleta.ativo {
  opacity: 1;
}

.roleta-nome {
  font-size: 56px;
  font-weight: 700;
  color: #fff;
  transition: transform 0.25s ease, color 0.25s ease;
}

/* FINAL */
.vencedor {
  color: var(--destaque);
  transform: scale(1.15);
}

.parabens {
  margin-top: 24px;
  font-size: 26px;
  opacity: 0;
  transition: opacity 1.2s ease;
}

.parabens.ativo {
  opacity: 1;
}

/* BOTÃO */
footer {
  position: absolute;
  bottom: 32px;
  width: 100%;
  display: flex;
  justify-content: center;
}

button {
  padding: 18px 36px;
  font-size: 20px;
  font-weight: 600;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  background: var(--destaque);
  color: #000;
  transition: opacity 1s ease;
}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Logo">
  <h1>Sorteio ao Vivo</h1>
</header>

<main>

  <!-- LISTA -->
  <div class="lista-container" id="lista">
    <div class="lista" id="listaInterna"></div>
  </div>

  <!-- ROLETA -->
  <div class="roleta" id="roleta">
    <div class="roleta-nome" id="roletaNome"></div>
    <div class="parabens" id="parabens">
      Parabéns, você é o ganhador(a) do sorteio!
    </div>
  </div>

</main>

<footer>
  <button id="btnSortear">Iniciar sorteio</button>
</footer>

<audio id="click1" src="click1.mp3" preload="auto"></audio>
<audio id="click2" src="click2.mp3" preload="auto"></audio>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSOjLw7gUCEfb1a9WbWWL2nx7IziAzih82r3tJCUIK_G6_9cVFkVhv6BwoqB3NhmFxLu5HHhDpVC4BG/pub?output=csv";
const COLUNA_NOME = 1;

const lista = document.getElementById("lista");
const listaInterna = document.getElementById("listaInterna");
const btn = document.getElementById("btnSortear");
const roleta = document.getElementById("roleta");
const roletaNome = document.getElementById("roletaNome");
const parabens = document.getElementById("parabens");

const click1 = document.getElementById("click1");
const click2 = document.getElementById("click2");

let participantes = [];
let ultimoIndiceCentro = -1;

async function carregarParticipantes() {
  const res = await fetch(CSV_URL);
  const texto = await res.text();
  const linhas = texto.split("\n").slice(1);

  linhas.forEach(l => {
    const cols = l.split(",");
    const nome = cols[COLUNA_NOME]?.replace(/"/g, "").trim();
    if (!nome) return;

    participantes.push(nome);

    const div = document.createElement("div");
    div.className = "participante";
    div.textContent = nome;
    listaInterna.appendChild(div);
  });

  atualizarScroll();
}

function atualizarScroll() {
  const centro = window.innerHeight / 2;
  const items = document.querySelectorAll(".participante");

  items.forEach((p, i) => {
    const rect = p.getBoundingClientRect();
    const pCentro = rect.top + rect.height / 2;
    const dist = Math.abs(pCentro - centro);
    const max = centro * 0.85;

    let t = Math.max(0, 1 - dist / max);

    const scale = 0.7 + t * 0.9;
    const opacity = 0.35 + t * 0.65;

    let color = "#777";
    if (t > 0.66) color = "#fbba16";
    else if (t > 0.33) color = "#fff";

    p.style.transform = `scale(${scale})`;
    p.style.opacity = opacity;
    p.style.color = color;

    if (t > 0.9 && ultimoIndiceCentro !== i) {
      click1.currentTime = 0;
      click1.play();
      ultimoIndiceCentro = i;
    }
  });
}

lista.addEventListener("scroll", atualizarScroll);

btn.addEventListener("click", async () => {
  btn.style.opacity = 0;
  lista.style.opacity = 0;

  setTimeout(() => {
    lista.style.display = "none";
    roleta.classList.add("ativo");
    iniciarRoleta();
  }, 1000);
});

function iniciarRoleta() {
  let indice = 0;
  let velocidade = 60;
  let duracao = 3500;
  let inicio = Date.now();

  const intervalo = setInterval(() => {
    roletaNome.textContent = participantes[indice % participantes.length];
    click2.currentTime = 0;
    click2.play();

    indice++;
    velocidade += 12;

    if (Date.now() - inicio > duracao) {
      clearInterval(intervalo);
      finalizarSorteio(roletaNome.textContent);
    }
  }, velocidade);
}

function finalizarSorteio(nome) {
  roletaNome.textContent = nome;
  roletaNome.classList.add("vencedor");

  setTimeout(() => parabens.classList.add("ativo"), 2000);
}

carregarParticipantes();
</script>

</body>
</html>
