<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Sorteio ao Vivo</title>

<style>
  * {
    box-sizing: border-box;
    font-family: Arial, Helvetica, sans-serif;
  }

  body {
    margin: 0;
    background: radial-gradient(circle at top, #111, #000);
    color: #fff;
    height: 100vh;
    overflow: hidden;
  }

  header {
    text-align: center;
    padding: 30px 20px 10px;
  }

  header img {
    height: 70px;
    margin-bottom: 10px;
  }

  header h1 {
    font-size: 26px;
    font-weight: 600;
    letter-spacing: 1px;
  }

  main {
    position: relative;
    height: calc(100vh - 220px);
    overflow: hidden;
  }

  /* LISTA DE PARTICIPANTES */
  .lista-container {
    height: 100%;
    overflow-y: auto;
    scroll-behavior: smooth;
  }

  .participante {
    text-align: center;
    font-size: 20px;
    opacity: 0.3;
    padding: 16px 0;
    transition: transform 0.2s ease, opacity 0.2s ease;
  }

  .participante.foco {
    font-size: 42px;
    opacity: 1;
    color: #fbba16;
    font-weight: bold;
  }

  /* ÁREA DE SORTEIO */
  .sorteio {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.6s ease;
  }

  .sorteio.ativo {
    opacity: 1;
    pointer-events: all;
  }

  .nome-atual {
    font-size: 48px;
    opacity: 0.4;
  }

  .nome-final {
    font-size: 72px;
    color: #fbba16;
    font-weight: 800;
    text-shadow: 0 0 40px rgba(251,186,22,0.8);
  }

  .parabens {
    margin-top: 20px;
    font-size: 24px;
    opacity: 0;
    transition: opacity 0.5s ease;
  }

  .parabens.show {
    opacity: 1;
  }

  /* BOTÃO */
  footer {
    position: absolute;
    bottom: 30px;
    width: 100%;
    text-align: center;
  }

  button {
    padding: 16px 40px;
    font-size: 18px;
    border: none;
    border-radius: 40px;
    cursor: pointer;
    background: #fbba16;
    color: #000;
    font-weight: bold;
  }

  button:disabled {
    opacity: 0.4;
    cursor: not-allowed;
  }
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Logo">
  <h1>Sorteio ao Vivo</h1>
</header>

<main>
  <div id="lista" class="lista-container"></div>

  <div id="sorteio" class="sorteio">
    <div id="display" class="nome-atual"></div>
    <div id="parabens" class="parabens">
      Parabéns, você é o(a) ganhador(a) do sorteio
    </div>
  </div>
</main>

<footer>
  <button id="btnSortear">Iniciar Sorteio</button>
</footer>

<script>
const CSV_URL =
  "https://docs.google.com/spreadsheets/d/e/2PACX-1vSOjLw7gUCEfb1a9WbWWL2nx7IziAzih82r3tJCUIK_G6_9cVFkVhv6BwoqB3NhmFxLu5HHhDpVC4BG/pub?output=csv";

const COLUNA_NOME = 1;

let participantes = [];
let sorteando = false;

async function carregarCSV() {
  const res = await fetch(CSV_URL + "&_=" + Date.now());
  const texto = await res.text();

  const linhas = texto.split("\n").slice(1);

  participantes = linhas.map(l => {
    const cols = l.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
    return cols?.[COLUNA_NOME]?.replace(/"/g, "").trim();
  }).filter(Boolean);

  renderLista();
}

function renderLista() {
  const lista = document.getElementById("lista");
  lista.innerHTML = "";

  participantes.forEach(nome => {
    const div = document.createElement("div");
    div.className = "participante";
    div.textContent = nome;
    lista.appendChild(div);
  });

  atualizarFoco();
}

function atualizarFoco() {
  const lista = document.getElementById("lista");
  const itens = [...document.querySelectorAll(".participante")];
  const centro = window.innerHeight / 2;

  itens.forEach(item => {
    const rect = item.getBoundingClientRect();
    const distancia = Math.abs(rect.top + rect.height / 2 - centro);

    if (distancia < 60) {
      item.classList.add("foco");
    } else {
      item.classList.remove("foco");
    }
  });
}

document.getElementById("lista")
  .addEventListener("scroll", atualizarFoco);

function iniciarSorteio() {
  if (sorteando) return;
  sorteando = true;

  document.getElementById("lista").style.opacity = 0;
  document.getElementById("sorteio").classList.add("ativo");

  const display = document.getElementById("display");
  let index = 0;
  let ciclos = 0;
  const total = 50 + Math.floor(Math.random() * 20);

  const intervalo = setInterval(() => {
    display.textContent = participantes[index];
    index = (index + 1) % participantes.length;
    ciclos++;

    if (ciclos >= total) {
      clearInterval(intervalo);

      const vencedor =
        participantes[Math.floor(Math.random() * participantes.length)];

      display.textContent = vencedor;
      display.className = "nome-final";

      setTimeout(() => {
        document.getElementById("parabens").classList.add("show");
      }, 2000);
    }
  }, 70);
}

document.getElementById("btnSortear")
  .addEventListener("click", iniciarSorteio);

carregarCSV();
</script>

</body>
</html>
