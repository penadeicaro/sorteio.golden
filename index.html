<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Sorteio ao Vivo</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --destaque: #fbba16;
  --cinza: #777;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html, body {
  width: 100%;
  height: 100%;
  overflow-x: hidden; /* REMOVE ROLAGEM HORIZONTAL */
}

body {
  background: #000;
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
  overflow-y: hidden;
}

/* TOPO */
header {
  text-align: center;
  padding-top: 32px;
}

header img {
  height: 80px;
  margin-bottom: 16px;
}

header h1 {
  font-size: 40px;
  font-weight: 700;
}

/* ÁREA CENTRAL */
main {
  height: calc(100vh - 200px);
  display: flex;
  justify-content: center;
  align-items: center;
  position: relative;
  overflow: hidden;
}

/* LISTA */
.lista-container {
  position: absolute;
  inset: 0;
  overflow-y: scroll;
  overflow-x: hidden;
  scrollbar-width: none;
}

.lista-container::-webkit-scrollbar {
  display: none;
}

.lista {
  padding-top: 45vh;
  padding-bottom: 45vh;
  width: 100%;
}

.participante {
  width: 100%;
  text-align: center;
  padding: 14px 0;
  font-size: 28px;
  color: var(--cinza);
  transform: scale(0.7);
  opacity: 0.35;
  will-change: transform, opacity, color;
  transition:
    transform 0.18s ease-out,
    opacity 0.18s ease-out,
    color 0.18s ease-out;
}

/* ROLETA */
.roleta {
  position: absolute;
  text-align: center;
  opacity: 0;
  transition: opacity 1s ease;
}

.roleta.ativo {
  opacity: 1;
}

.roleta-nome {
  font-size: 56px;
  font-weight: 700;
  color: #fff;
}

.vencedor {
  color: var(--destaque);
  transform: scale(1.15);
}

.parabens {
  margin-top: 24px;
  font-size: 26px;
  opacity: 0;
  transition: opacity 1.2s ease;
}

.parabens.ativo {
  opacity: 1;
}

/* BOTÃO */
footer {
  position: absolute;
  bottom: 32px;
  width: 100%;
  display: flex;
  justify-content: center;
}

button {
  padding: 18px 36px;
  font-size: 20px;
  font-weight: 600;
  border-radius: 999px;
  border: none;
  cursor: pointer;
  background: var(--destaque);
  color: #000;
  transition: opacity 1s ease;
}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="Logo">
  <h1>Sorteio ao Vivo</h1>
</header>

<main>

  <div class="lista-container" id="lista">
    <div class="lista" id="listaInterna"></div>
  </div>

  <div class="roleta" id="roleta">
    <div class="roleta-nome" id="roletaNome"></div>
    <div class="parabens" id="parabens">
      Parabéns, você é o ganhador(a) do sorteio!
    </div>
  </div>

</main>

<footer>
  <button id="btnSortear">Iniciar sorteio</button>
</footer>

<audio id="click1" src="click1.mp3" preload="auto"></audio>
<audio id="click2" src="click2.mp3" preload="auto"></audio>

<script>
const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vSOjLw7gUCEfb1a9WbWWL2nx7IziAzih82r3tJCUIK_G6_9cVFkVhv6BwoqB3NhmFxLu5HHhDpVC4BG/pub?output=csv";
const COLUNA_NOME = 1;

const lista = document.getElementById("lista");
const listaInterna = document.getElementById("listaInterna");
const btn = document.getElementById("btnSortear");
const roleta = document.getElementById("roleta");
const roletaNome = document.getElementById("roletaNome");
const parabens = document.getElementById("parabens");

const click1 = document.getElementById("click1");
const click2 = document.getElementById("click2");

let participantes = [];
let indiceCentralAtual = null;

/* ===== CSV ===== */
async function carregarParticipantes() {
  const res = await fetch(CSV_URL);
  const texto = await res.text();
  const linhas = texto.split("\n").slice(1);

  linhas.forEach(l => {
    const cols = l.split(",");
    const nome = cols[COLUNA_NOME]?.replace(/"/g, "").trim();
    if (!nome) return;

    participantes.push(nome);

    const div = document.createElement("div");
    div.className = "participante";
    div.textContent = nome;
    listaInterna.appendChild(div);
  });
}

/* ===== SOM SCROLL ===== */
function tocarClickScroll() {
  const som = click1.cloneNode();
  som.volume = 0.55;
  som.play();
}

/* ===== LOOP CONTÍNUO (CORRIGIDO - SEM TREMOR) ===== */
function loopFoco() {
  const items = document.querySelectorAll(".participante");
  const centroY = window.innerHeight / 2;

  let menorDist = Infinity;
  let indiceMaisProximo = null;

  items.forEach((p, i) => {
    const rect = p.getBoundingClientRect();
    const centro = rect.top + rect.height / 2;
    const dist = Math.abs(centro - centroY);

    if (dist < menorDist) {
      menorDist = dist;
      indiceMaisProximo = i;
    }
  });

  // Só atualiza se mudou o índice central
  if (indiceMaisProximo !== indiceCentralAtual && indiceMaisProximo !== null) {
    items.forEach((p, i) => {
      const rect = p.getBoundingClientRect();
      const centro = rect.top + rect.height / 2;
      const dist = Math.abs(centro - centroY);
      const max = centroY * 0.9;
      const t = Math.max(0, 1 - dist / max);

      p.style.transform = `scale(${0.7 + t * 0.75})`;
      p.style.opacity = 0.3 + t * 0.6;
      p.style.color = "#777";
    });

    const p = items[indiceMaisProximo];
    p.style.color = "#fbba16";
    p.style.transform = "scale(1.5)";
    p.style.opacity = 1;

    tocarClickScroll();
    indiceCentralAtual = indiceMaisProximo;
  }

  requestAnimationFrame(loopFoco);
}

/* ===== SORTEIO ===== */
btn.addEventListener("click", () => {
  btn.style.opacity = 0;
  lista.style.opacity = 0;

  setTimeout(() => {
    lista.style.display = "none";
    roleta.classList.add("ativo");
    iniciarRoleta();
  }, 1000);
});

function iniciarRoleta() {
  let indice = 0;
  let velocidade = 60;
  const inicio = Date.now();
  const duracao = 3500;

  const loop = setInterval(() => {
    roletaNome.textContent = participantes[indice % participantes.length];
    click2.currentTime = 0;
    click2.play();

    indice++;
    velocidade += 12;

    if (Date.now() - inicio > duracao) {
      clearInterval(loop);
      finalizar(roletaNome.textContent);
    }
  }, velocidade);
}

function finalizar(nome) {
  roletaNome.textContent = nome;
  roletaNome.classList.add("vencedor");
  setTimeout(() => parabens.classList.add("ativo"), 2000);
}

/* INIT */
carregarParticipantes().then(() => {
  requestAnimationFrame(loopFoco);
});
</script>

</body>
</html>
